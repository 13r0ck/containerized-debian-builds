From aa620fdf8e9364fc64116923c3855ca15d9b5c3e Mon Sep 17 00:00:00 2001
From: Dylan Baker <dylan@pnwbakers.com>
Date: Thu, 10 Oct 2019 15:18:40 -0700
Subject: [PATCH] meson: generate .pc files for gles and gles2 with old glvnd

Closes: https://gitlab.freedesktop.org/mesa/mesa/issues/1921
---
 src/mapi/meson.build | 28 ++++++++++++++++++++++++----
 1 file changed, 24 insertions(+), 4 deletions(-)

diff --git a/src/mapi/meson.build b/src/mapi/meson.build
index 2c79a04f1df..bf9e982d149 100644
--- a/src/mapi/meson.build
+++ b/src/mapi/meson.build
@@ -1,4 +1,4 @@
-# Copyright © 2017 Intel Corporation
+# Copyright © 2017-2019 Intel Corporation
 
 # Permission is hereby granted, free of charge, to any person obtaining a copy
 # of this software and associated documentation files (the "Software"), to deal
@@ -35,11 +35,31 @@ if with_shared_glapi
 else
   libglapi = []
 endif
-if not with_glvnd
-  if with_gles1
+if with_gles1
+  if not with_glvnd
     subdir('es1api')
+  elif not glvnd_has_headers_and_pc_files
+    pkg.generate(
+      name : 'glesv1_cm',
+      filebase : 'glesv1_cm',
+      description : 'Mesa OpenGL ES 1.1 CM library',
+      version : meson.project_version(),
+      libraries : '-L${libdir} -lGLESv1_CM',
+      libraries_private : gl_priv_libs,
+    )
   endif
-  if with_gles2
+endif
+if with_gles2
+  if not with_glvnd
     subdir('es2api')
+  elif not glvnd_has_headers_and_pc_files
+    pkg.generate(
+      name : 'glesv2',
+      filebase : 'glesv2',
+      description : 'Mesa OpenGL ES 2.0 library',
+      version : meson.project_version(),
+      libraries : '-L${libdir} -lGLESv2',
+      libraries_private : gl_priv_libs,
+    )
   endif
 endif
-- 
2.20.1

